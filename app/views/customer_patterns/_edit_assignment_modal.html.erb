<div class="modal-header bg-primary text-white">
  <h5 class="modal-title d-flex align-items-center">
    <i class="fas fa-edit me-2"></i>
    Edit Assignment
  </h5>
  <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
</div>

<div class="modal-body">
  <!-- Customer and Date Info -->
  <div class="alert alert-info d-flex align-items-center mb-4">
    <i class="fas fa-user me-3 fa-2x"></i>
    <div>
      <h6 class="mb-1 fw-bold"><%= assignment.customer.name %></h6>
      <small class="text-muted">
        <i class="fas fa-calendar me-1"></i>
        <%= assignment.scheduled_date.strftime("%d %B %Y") %>
        (<%= assignment.scheduled_date.strftime("%A") %>)
      </small>
    </div>
  </div>

  <%= form_with model: assignment, url: update_assignment_customer_pattern_path(assignment), local: false, id: "edit-assignment-form", data: { assignment_id: assignment.id }, scope: :delivery_assignment do |form| %>
    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <%= form.label :quantity, "Quantity", class: "form-label fw-bold" %>
          <%= form.number_field :quantity, class: "form-control form-control-lg", step: 0.1, min: 0, placeholder: "Enter quantity" %>
        </div>
      </div>
      <div class="col-md-6">
        <div class="mb-3">
          <%= form.label :unit, "Unit", class: "form-label fw-bold" %>
          <%= form.select :unit,
              options_for_select([
                ['Liters', 'liters'],
                ['Gallons', 'gallons'],
                ['Kilograms', 'kg'],
                ['Pounds', 'pounds'],
                ['Pieces', 'pieces']
              ], assignment.unit),
              {},
              { class: "form-select form-select-lg" } %>
        </div>
      </div>
    </div>

    <!-- Hidden fields for unchanged values -->
    <%= form.hidden_field :scheduled_date %>
    <%= form.hidden_field :status %>
    <%= form.hidden_field :discount_amount %>
  <% end %>
</div>

<div class="modal-footer">
  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
    <i class="fas fa-times me-1"></i>Cancel
  </button>
  <button type="button" class="btn btn-primary btn-lg" id="update-assignment-btn" data-assignment-id="<%= assignment.id %>">
    <i class="fas fa-save me-2"></i>Save Changes
  </button>
</div>

<!-- JavaScript moved to main page for proper execution -->
<script>
// Completely prevent form submission to stop navigation
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('edit-assignment-form');
  if (form) {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      e.stopPropagation();
      console.log('ðŸ›‘ Form submission prevented - using AJAX handler instead');
      return false;
    });
  }
});
</script>