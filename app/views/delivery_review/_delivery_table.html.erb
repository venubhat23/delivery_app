<% if @deliveries.present? %>
  <% @deliveries.each do |d| %>
    <% 
      # Calculate proportional amount and product cost
      base_rate_per_liter = 200.0
      proportional_amount = (d.quantity.to_f * base_rate_per_liter).round(2)
      product_cost = (d.quantity.to_f * proportional_amount).round(2)
    %>
    <tr>
      <td><%= d.scheduled_date.strftime('%b %d, %Y') %></td>
      <td><%= d.customer&.name %></td>
      <td><%= d.product&.name %></td>
      <td><%= "#{d.quantity} #{d.unit}" %></td>
      <td><%= number_to_currency(proportional_amount, unit: '₹') %></td>
      <td class="text-info fw-bold"><%= number_to_currency(product_cost, unit: '₹') %></td>
      <td>
        <% cls = case d.status
          when 'completed' then 'badge bg-success'
          when 'pending' then 'badge bg-warning text-dark'
          when 'cancelled' then 'badge bg-danger'
          when 'in_progress' then 'badge bg-info text-white'
          else 'badge bg-secondary' end %>
        <span class="<%= cls %>"><%= d.status.to_s.humanize %></span>
      </td>
      <td><%= d.delivery_person&.name || 'Not Assigned' %></td>
    </tr>
  <% end %>
<% else %>
  <tr><td colspan="8" class="text-center text-muted">No records found</td></tr>
<% end %>