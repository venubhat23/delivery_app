<!-- Simple Procurement Assignments Modal Content -->

<% if @assignments.any? %>
  <!-- Quick Actions at Top -->
  <% pending_assignments = @assignments.where(status: 'pending') %>
  <% pending_till_today = @assignments.where(status: 'pending').where('date <= ?', Date.current) %>
  <% if pending_assignments.any? %>
    <div class="mb-4">
      <div class="alert alert-info d-flex align-items-center">
        <i class="fas fa-clipboard-list me-3 fa-2x text-info"></i>
        <div class="flex-grow-1">
          <strong>üìã Pending Procurement Alert</strong><br>
          <small>There are <strong><%= pending_assignments.count %></strong> pending procurement assignments.</small>
          <% if pending_till_today.any? %>
            <br><small class="text-warning">‚ö†Ô∏è <strong><%= pending_till_today.count %></strong> assignments are due till today</small>
          <% end %>
        </div>
        <div class="d-flex flex-column gap-2">
          <% if pending_till_today.any? %>
            <button class="btn btn-warning btn-sm shadow" onclick="completeTillToday('<%= @schedule.vendor_name %>')">
              <i class="fas fa-clock me-2"></i>
              Complete Till Today (<%= pending_till_today.count %>)
            </button>
          <% end %>
          <button class="btn btn-success btn-sm shadow" onclick="markAllCompleted(<%= @schedule.id %>)">
            <i class="fas fa-check-double me-2"></i>
            Mark All Completed (<%= pending_assignments.count %>)
          </button>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Assignments Table -->
  <div class="card">
    <div class="card-header bg-light">
      <h6 class="mb-0">
        <i class="fas fa-clipboard-list me-2"></i>
        Procurement Assignments for <%= @schedule.vendor_name %> (<%= @assignments.count %> items)
      </h6>
    </div>
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-dark">
          <tr>
            <th><i class="fas fa-calendar me-1"></i>Date</th>
            <th><i class="fas fa-cube me-1"></i>Product</th>
            <th><i class="fas fa-weight me-1"></i>Quantity</th>
            <th><i class="fas fa-rupee-sign me-1"></i>Rate</th>
            <th><i class="fas fa-info-circle me-1"></i>Status</th>
            <th><i class="fas fa-calculator me-1"></i>Amount</th>
            <th><i class="fas fa-cogs me-1"></i>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% total_amount = 0 %>
          <% @assignments.each_with_index do |assignment, index| %>
            <% quantity = assignment.actual_quantity.presence || assignment.planned_quantity || 0 %>
            <% rate = assignment.buying_price || @schedule.buying_price || 0 %>
            <% amount = quantity * rate %>
            <% total_amount += amount %>
            <tr class="<%= 'table-light' if index.even? %>">
              <td>
                <div class="d-flex align-items-center">
                  <div class="date-circle bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 35px; height: 35px; font-size: 12px; font-weight: bold;">
                    <%= assignment.date.strftime("%d") %>
                  </div>
                  <div>
                    <div class="fw-semibold"><%= assignment.date.strftime("%b %Y") %></div>
                    <small class="text-muted"><%= assignment.date.strftime("%A") %></small>
                  </div>
                </div>
              </td>
              <td>
                <div class="d-flex align-items-center">
                  <i class="fas fa-cube text-primary me-2"></i>
                  <div>
                    <div class="fw-semibold"><%= assignment.product&.name || @schedule.product&.name || 'Milk' %></div>
                    <small class="text-muted">Assignment #<%= assignment.id %></small>
                  </div>
                </div>
              </td>
              <td>
                <span class="badge bg-info text-white">
                  <strong><%= number_with_precision(quantity, precision: 1) %></strong> L
                </span>
              </td>
              <td>
                <div class="text-success fw-bold">
                  ‚Çπ<%= number_with_precision(rate, precision: 2) %>/L
                </div>
              </td>
              <td>
                <% case assignment.status %>
                <% when 'completed' %>
                  <span class="badge bg-success rounded-pill">
                    <i class="fas fa-check me-1"></i>Completed
                  </span>
                <% when 'pending' %>
                  <span class="badge bg-warning rounded-pill">
                    <i class="fas fa-clock me-1"></i>Pending
                  </span>
                <% when 'in_progress' %>
                  <span class="badge bg-info rounded-pill">
                    <i class="fas fa-truck me-1"></i>In Progress
                  </span>
                <% else %>
                  <span class="badge bg-secondary rounded-pill">
                    <i class="fas fa-pause me-1"></i><%= assignment.status.titleize %>
                  </span>
                <% end %>
              </td>
              <td>
                <div class="text-primary fw-bold">
                  ‚Çπ<%= number_with_delimiter(amount.round(2)) %>
                </div>
                <small class="text-muted">
                  <%= number_with_precision(quantity, precision: 1) %>L √ó ‚Çπ<%= number_with_precision(rate, precision: 2) %>
                </small>
              </td>
              <td>
                <div class="d-flex flex-column gap-1" style="min-width: 80px;">
                  <button class="btn btn-outline-primary btn-sm"
                          onclick="editProcurementAssignment(<%= assignment.id %>)"
                          title="Edit Assignment">
                    <i class="fas fa-edit me-1"></i>Edit
                  </button>
                  <button class="btn btn-outline-success btn-sm"
                          onclick="completeProcurementAssignment(<%= assignment.id %>)"
                          title="Mark Complete"
                          <%= 'disabled' if assignment.status == 'completed' %>>
                    <i class="fas fa-check me-1"></i>Complete
                  </button>
                  <button class="btn btn-outline-danger btn-sm"
                          onclick="deleteProcurementAssignment(<%= assignment.id %>)"
                          title="Delete Assignment">
                    <i class="fas fa-trash me-1"></i>Delete
                  </button>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
        <tfoot class="table-light">
          <tr>
            <th colspan="5" class="text-end">Total Purchase Cost:</th>
            <th>
              <div class="text-primary fw-bold">
                ‚Çπ<%= number_with_delimiter(total_amount.round(2)) %>
              </div>
            </th>
            <th></th>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>

<% else %>
  <!-- Empty State -->
  <div class="text-center py-5">
    <div class="empty-state-icon mb-4">
      <i class="fas fa-clipboard-list fa-4x text-muted"></i>
    </div>
    <h4 class="text-muted mb-3">No Procurement Assignments Found</h4>
    <p class="text-muted mb-4">
      No procurement assignments were found for <strong><%= @schedule.vendor_name %></strong> in this schedule.
    </p>
    <button class="btn btn-primary" onclick="createProcurementAssignment(<%= @schedule.id %>)">
      <i class="fas fa-plus me-1"></i>Create New Assignment
    </button>
  </div>
<% end %>