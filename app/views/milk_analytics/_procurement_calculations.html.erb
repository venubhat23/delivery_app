<!-- Procurement Calculations -->
<div class="row mb-4">
  <div class="col-12">
    <h6 class="text-primary mb-3">
      <i class="fas fa-truck-loading me-2"></i>Procurement Cost Analysis
    </h6>

    <div class="row">
      <!-- Total Procurement Summary -->
      <div class="col-md-6 mb-3">
        <div class="card border-primary">
          <div class="card-header bg-light">
            <h6 class="mb-0">ðŸ“¦ Total Procurement Overview</h6>
          </div>
          <div class="card-body">
            <table class="table table-sm mb-0">
              <tr>
                <td><strong>Total Vendors:</strong></td>
                <td class="text-end"><%= @procurement_summary&.dig(:total_vendors) || @total_vendors || 0 %></td>
              </tr>
              <tr>
                <td><strong>Total Quantity:</strong></td>
                <td class="text-end"><%= number_with_delimiter(@procurement_summary&.dig(:total_quantity) || @total_liters || 0) %> L</td>
              </tr>
              <tr>
                <td><strong>Total Cost:</strong></td>
                <td class="text-end">â‚¹<%= number_with_delimiter(@procurement_summary&.dig(:total_amount) || @total_cost || 0, precision: 2) %></td>
              </tr>
              <tr>
                <td><strong>Average Price:</strong></td>
                <td class="text-end">â‚¹<%= (@procurement_summary&.dig(:average_price) || 0).round(2) %> per L</td>
              </tr>
            </table>
          </div>
        </div>
      </div>

      <!-- Procurement Formula -->
      <div class="col-md-6 mb-3">
        <div class="card border-info">
          <div class="card-header bg-light">
            <h6 class="mb-0">ðŸ§® Procurement Cost Formula</h6>
          </div>
          <div class="card-body">
            <div class="formula-box p-3 bg-light rounded">
              <p class="mb-2"><strong>Total Procurement Cost =</strong></p>
              <p class="mb-2">Î£ (Quantity Ã— Buying Price)</p>
              <hr class="my-2">
              <p class="mb-2"><strong>Average Cost Per Liter =</strong></p>
              <p class="mb-0">Total Cost Ã· Total Quantity</p>
            </div>
            <small class="text-muted">
              <i class="fas fa-info-circle me-1"></i>
              Calculated across all vendors and products for the selected period
            </small>
          </div>
        </div>
      </div>
    </div>

    <!-- Vendor-wise Breakdown -->
    <% if @vendor_analysis.present? && @vendor_analysis.any? %>
      <div class="mt-3">
        <h6 class="text-secondary mb-2">
          <i class="fas fa-users me-2"></i>Vendor-wise Procurement Breakdown
        </h6>
        <div class="table-responsive">
          <table class="table table-sm table-striped">
            <thead class="table-dark">
              <tr>
                <th>Vendor</th>
                <th class="text-end">Quantity (L)</th>
                <th class="text-end">Total Cost (â‚¹)</th>
                <th class="text-end">Avg Price (â‚¹/L)</th>
                <th class="text-end">Share (%)</th>
              </tr>
            </thead>
            <tbody>
              <% total_cost = @vendor_analysis.sum { |v| v[:total_amount] || 0 } %>
              <% @vendor_analysis.first(10).each do |vendor| %>
                <tr>
                  <td><%= vendor[:vendor_name] %></td>
                  <td class="text-end"><%= number_with_delimiter(vendor[:total_quantity] || 0) %></td>
                  <td class="text-end">â‚¹<%= number_with_delimiter(vendor[:total_amount] || 0, precision: 2) %></td>
                  <td class="text-end">â‚¹<%= (vendor[:average_price] || 0).round(2) %></td>
                  <td class="text-end">
                    <%= total_cost > 0 ? ((vendor[:total_amount] || 0) * 100.0 / total_cost).round(1) : 0 %>%
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
        <% if @vendor_analysis.size > 10 %>
          <small class="text-muted">
            <i class="fas fa-info-circle me-1"></i>
            Showing top 10 vendors. Total: <%= @vendor_analysis.size %> vendors
          </small>
        <% end %>
      </div>
    <% end %>
  </div>
</div>