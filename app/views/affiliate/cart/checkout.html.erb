<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="text-dark mb-0">
    <i class="fas fa-credit-card me-2 text-primary"></i>
    Checkout
  </h2>
  <div class="d-flex gap-2">
    <%= link_to affiliate_cart_path, class: "btn btn-outline-secondary" do %>
      <i class="fas fa-arrow-left me-1"></i>
      Back to Cart
    <% end %>
  </div>
</div>

<div class="row">
  <!-- Order Form -->
  <div class="col-lg-7">
    <%= form_with url: affiliate_cart_place_order_path, method: :post, local: true, class: "needs-validation", novalidate: true do |form| %>
      <!-- Order Details -->
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">
            <i class="fas fa-clipboard-list me-2"></i>
            Order Information
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Affiliate Name</label>
              <div class="form-control-plaintext bg-light px-3 py-2 rounded">
                <%= current_affiliate.name %>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Email</label>
              <div class="form-control-plaintext bg-light px-3 py-2 rounded">
                <%= current_affiliate.email %>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Phone</label>
              <div class="form-control-plaintext bg-light px-3 py-2 rounded">
                <%= current_affiliate.phone %>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Location</label>
              <div class="form-control-plaintext bg-light px-3 py-2 rounded">
                <%= current_affiliate.location %>
              </div>
            </div>
          </div>

          <div class="mb-3">
            <%= form.label :notes, "Order Notes (Optional)", class: "form-label" %>
            <%= form.text_area :notes,
                class: "form-control",
                rows: 3,
                placeholder: "Any special requirements, delivery instructions, or notes..." %>
            <div class="form-text">Additional details about your order or special requirements.</div>
          </div>
        </div>
      </div>

      <!-- Order Items Review -->
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-header bg-light">
          <h5 class="mb-0">
            <i class="fas fa-list-check me-2"></i>
            Review Your Order (<%= @cart_items.count %> items)
          </h5>
        </div>
        <div class="card-body p-0">
          <% @cart_items.each do |item| %>
            <div class="border-bottom p-3">
              <div class="row align-items-center">
                <div class="col-2">
                  <% if item[:product].image_url.present? %>
                    <img src="<%= item[:product].image_url %>"
                         class="img-fluid rounded"
                         style="height: 50px; width: 50px; object-fit: cover;"
                         alt="<%= item[:product].name %>" />
                  <% else %>
                    <div class="bg-light rounded d-flex align-items-center justify-content-center"
                         style="height: 50px; width: 50px;">
                      <i class="fas fa-image text-muted"></i>
                    </div>
                  <% end %>
                </div>
                <div class="col-5">
                  <h6 class="mb-1 fw-bold"><%= item[:product].name %></h6>
                  <small class="text-muted">
                    ₹<%= item[:price] %> per <%= item[:product].unit_type || 'unit' %>
                  </small>
                  <% if item[:product].category %>
                    <br><small class="badge bg-light text-dark"><%= item[:product].category.name %></small>
                  <% end %>
                </div>
                <div class="col-2 text-center">
                  <span class="badge bg-primary"><%= item[:quantity] %> <%= item[:product].unit_type || 'units' %></span>
                </div>
                <div class="col-3 text-end">
                  <span class="h6 text-success fw-bold">₹<%= item[:total].to_i %></span>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Terms and Confirmation -->
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-header bg-warning text-dark">
          <h5 class="mb-0">
            <i class="fas fa-file-contract me-2"></i>
            Terms & Conditions
          </h5>
        </div>
        <div class="card-body">
          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="terms" required>
            <label class="form-check-label" for="terms">
              I agree to the <a href="#" class="text-primary">Terms and Conditions</a> and <a href="#" class="text-primary">Privacy Policy</a>
            </label>
            <div class="invalid-feedback">
              You must agree to the terms before placing your order.
            </div>
          </div>

          <div class="alert alert-info">
            <h6 class="mb-2">
              <i class="fas fa-info-circle me-2"></i>
              Important Information
            </h6>
            <ul class="mb-0 small">
              <li>Orders will be processed within 24-48 hours</li>
              <li>Delivery charges are free for affiliate orders</li>
              <li>You will receive order confirmation via email and WhatsApp</li>
              <li>Payment will be processed after delivery confirmation</li>
              <li>Orders can be modified or cancelled within 2 hours of placement</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="d-grid">
        <%= form.submit "Place Order",
            class: "btn btn-success btn-lg",
            data: { confirm: "Are you sure you want to place this order?" } %>
      </div>
    <% end %>
  </div>

  <!-- Order Summary Sidebar -->
  <div class="col-lg-5">
    <div class="card shadow-sm border-0 sticky-top" style="top: 100px;">
      <div class="card-header bg-success text-white">
        <h5 class="mb-0">
          <i class="fas fa-receipt me-2"></i>
          Order Summary
        </h5>
      </div>
      <div class="card-body">
        <!-- Items Summary -->
        <div class="mb-3">
          <h6 class="text-muted mb-2">Items in your order:</h6>
          <% @cart_items.each do |item| %>
            <div class="d-flex justify-content-between align-items-center mb-1">
              <small>
                <%= item[:product].name %>
                <span class="text-muted">(×<%= item[:quantity] %>)</span>
              </small>
              <small class="fw-bold">₹<%= item[:total].to_i %></small>
            </div>
          <% end %>
        </div>

        <hr>

        <!-- Price Breakdown -->
        <div class="d-flex justify-content-between mb-2">
          <span>Subtotal:</span>
          <span class="fw-bold">₹<%= @cart_total.to_i %></span>
        </div>
        <div class="d-flex justify-content-between mb-2">
          <span>Delivery Charges:</span>
          <span class="text-success fw-bold">Free</span>
        </div>
        <div class="d-flex justify-content-between mb-2">
          <span>Taxes & Fees:</span>
          <span class="text-success fw-bold">Included</span>
        </div>
        <hr class="my-3">
        <div class="d-flex justify-content-between mb-3">
          <span class="h5">Total Amount:</span>
          <span class="h5 text-success fw-bold">₹<%= @cart_total.to_i %></span>
        </div>

        <!-- Affiliate Benefits -->
        <div class="alert alert-success">
          <h6 class="mb-2">
            <i class="fas fa-star me-2"></i>
            Affiliate Benefits
          </h6>
          <ul class="mb-0 small">
            <li>Free delivery on all orders</li>
            <li>Exclusive affiliate pricing</li>
            <li>Priority customer support</li>
            <li>Flexible payment terms</li>
          </ul>
        </div>

        <!-- Contact Info -->
        <div class="text-center mt-3">
          <small class="text-muted">
            <i class="fas fa-phone me-1"></i>
            Need help? Call us at +91 98765 43210
          </small>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Bootstrap form validation
(function() {
  'use strict';
  window.addEventListener('load', function() {
    var forms = document.getElementsByClassName('needs-validation');
    Array.prototype.filter.call(forms, function(form) {
      form.addEventListener('submit', function(event) {
        if (form.checkValidity() === false) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  }, false);
})();

// Sticky sidebar behavior
document.addEventListener('DOMContentLoaded', function() {
  // Auto-scroll to top when page loads
  window.scrollTo(0, 0);
});
</script>

<style>
.sticky-top {
  position: -webkit-sticky;
  position: sticky;
}

@media (max-width: 992px) {
  .sticky-top {
    position: static;
    margin-top: 1rem;
  }
}

.form-control-plaintext {
  border: 1px solid #e9ecef;
}
</style>