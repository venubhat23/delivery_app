<div class="container-fluid">
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <h2 class="mb-0">
          <i class="fas fa-users me-2"></i>
          Affiliate Management
        </h2>
        <%= link_to new_admin_affiliate_path, class: "btn btn-primary" do %>
          <i class="fas fa-plus me-1"></i>
          Add New Affiliate
        <% end %>
      </div>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="row mb-4">
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center">
          <div class="text-primary mb-2">
            <i class="fas fa-users fa-2x"></i>
          </div>
          <h4 class="text-primary"><%= @affiliates.count %></h4>
          <p class="text-muted mb-0">Total Affiliates</p>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center">
          <div class="text-warning mb-2">
            <i class="fas fa-clock fa-2x"></i>
          </div>
          <h4 class="text-warning"><%= @pending_affiliates.count %></h4>
          <p class="text-muted mb-0">Pending Approval</p>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center">
          <div class="text-success mb-2">
            <i class="fas fa-check-circle fa-2x"></i>
          </div>
          <h4 class="text-success"><%= @approved_affiliates.count %></h4>
          <p class="text-muted mb-0">Active Affiliates</p>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center">
          <div class="text-info mb-2">
            <i class="fas fa-rupee-sign fa-2x"></i>
          </div>
          <h4 class="text-info">₹<%= number_with_delimiter(@total_earnings.to_i) %></h4>
          <p class="text-muted mb-0">Total Earnings</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Affiliates Table -->
  <div class="card border-0 shadow-sm">
    <div class="card-header bg-light border-0">
      <h5 class="card-title mb-0">
        <i class="fas fa-table me-2"></i>
        All Affiliates
      </h5>
    </div>
    <div class="card-body">
      <% if @affiliates.any? %>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead class="table-light">
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Location</th>
                <th>Commission Rate</th>
                <th>Referral Code</th>
                <th>Status</th>
                <th>Total Earnings</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% @affiliates.each do |affiliate| %>
                <tr>
                  <td><strong><%= affiliate.name %></strong></td>
                  <td><%= affiliate.email %></td>
                  <td><%= affiliate.phone %></td>
                  <td><%= affiliate.location %></td>
                  <td><%= affiliate.commission_rate %>%</td>
                  <td>
                    <code class="badge bg-secondary"><%= affiliate.referral_code %></code>
                  </td>
                  <td>
                    <%
                      status_text = affiliate.status&.capitalize || 'Pending'
                      badge_class = begin
                        if affiliate.pending?
                          'warning'
                        elsif affiliate.approved?
                          'success'
                        elsif affiliate.suspended?
                          'danger'
                        else
                          'secondary'
                        end
                      rescue
                        'secondary'
                      end
                    %>
                    <span class="badge bg-<%= badge_class %>">
                      <%= status_text %>
                    </span>
                  </td>
                  <td>₹<%= number_with_delimiter((affiliate.total_earnings || 0).to_i) %></td>
                  <td>
                    <div class="btn-group" role="group">
                      <%= link_to admin_affiliate_path(affiliate), class: "btn btn-outline-primary btn-sm" do %>
                        <i class="fas fa-eye"></i>
                      <% end %>
                      <%= link_to edit_admin_affiliate_path(affiliate), class: "btn btn-outline-secondary btn-sm" do %>
                        <i class="fas fa-edit"></i>
                      <% end %>
                      <% begin %>
                        <% if affiliate.pending? %>
                          <%= link_to approve_admin_affiliate_path(affiliate), method: :patch, class: "btn btn-outline-success btn-sm",
                              confirm: "Approve this affiliate?" do %>
                            <i class="fas fa-check"></i>
                          <% end %>
                        <% end %>
                      <% rescue %>
                        <%= link_to approve_admin_affiliate_path(affiliate), method: :patch, class: "btn btn-outline-success btn-sm",
                            confirm: "Approve this affiliate?" do %>
                          <i class="fas fa-check"></i>
                        <% end %>
                      <% end %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="text-center py-5">
          <i class="fas fa-users fa-3x text-muted mb-3"></i>
          <h5 class="text-muted">No Affiliates Found</h5>
          <p class="text-muted">Start building your affiliate network!</p>
          <%= link_to new_admin_affiliate_path, class: "btn btn-primary" do %>
            <i class="fas fa-plus me-1"></i>
            Add First Affiliate
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>