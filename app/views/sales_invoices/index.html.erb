<!-- Clean Sales Invoices Interface -->
<div class="page-wrapper">
  <!-- Page Header -->
  <div class="page-header">
    <div class="container-fluid">
      <div class="row align-items-center">
        <div class="col">
          <div class="header-content">
            <div class="header-icon">
              <i class="fas fa-file-invoice-dollar"></i>
            </div>
            <div class="header-text">
              <h1>Sales Invoices</h1>
              <p>Manage your sales invoices and track payments</p>
            </div>
          </div>
        </div>
        <div class="col-auto">
          <%= link_to new_sales_invoice_path, class: "btn btn-primary btn-create" do %>
            <i class="fas fa-plus"></i>
            <span>New Invoice</span>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="container-fluid">
    <div class="stats-section">
      <div class="row g-4">
        <div class="col-lg-3 col-sm-6">
          <div class="stat-card stat-card-blue">
            <div class="stat-icon">
              <i class="fas fa-chart-line"></i>
            </div>
            <div class="stat-content">
              <h3>₹<%= number_with_delimiter(@total_sales || 0, precision: 0) %></h3>
              <p>Total Sales</p>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-sm-6">
          <div class="stat-card stat-card-green">
            <div class="stat-icon">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-content">
              <h3>₹<%= number_with_delimiter(@total_paid || 0, precision: 0) %></h3>
              <p>Paid Amount</p>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-sm-6">
          <div class="stat-card stat-card-orange">
            <div class="stat-icon">
              <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
              <h3>₹<%= number_with_delimiter(@total_unpaid || 0, precision: 0) %></h3>
              <p>Unpaid Amount</p>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-sm-6">
          <div class="stat-card stat-card-red">
            <div class="stat-icon">
              <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-content">
              <h3><%= @overdue_count || 0 %></h3>
              <p>Overdue Invoices</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="filters-section">
      <div class="filters-card">
        <%= form_with url: sales_invoices_path, method: :get, local: true, class: 'filters-form' do |form| %>
          <div class="row g-3">
            <div class="col-lg-3 col-md-6">
              <%= form.text_field :customer, 
                  placeholder: 'Search customer...', 
                  value: params[:customer], 
                  class: 'form-control' %>
            </div>
            <div class="col-lg-2 col-md-6">
              <%= form.select :status, 
                  options_for_select([
                    ['All Status', ''],
                    ['Paid', 'paid'],
                    ['Unpaid', 'pending'],
                    ['Partially Paid', 'partially_paid'],
                    ['Overdue', 'overdue']
                  ], params[:status]), 
                  {}, { class: 'form-select' } %>
            </div>
            <div class="col-lg-2 col-md-6">
              <%= form.select :month,
                  options_for_select((1..12).map { |m| [Date::MONTHNAMES[m], m] }.unshift(['All Months', '']), params[:month]),
                  {}, { class: 'form-select' } %>
            </div>
            <div class="col-lg-2 col-md-6">
              <%= form.select :year,
                  options_for_select((2020..Date.current.year + 1).to_a.reverse.map { |y| [y, y] }.unshift(['All Years', '']), params[:year]),
                  {}, { class: 'form-select' } %>
            </div>
            <div class="col-lg-2 col-md-6">
              <%= form.number_field :amount_min, 
                  placeholder: 'Min amount', 
                  value: params[:amount_min], 
                  class: 'form-control' %>
            </div>
            <div class="col-lg-1 col-md-6">
              <%= form.submit 'Filter', class: 'btn btn-outline-primary w-100' %>
            </div>
          </div>
          
          <% if params.to_unsafe_h.any? { |k, v| k.in?(['customer', 'status', 'month', 'year', 'amount_min']) && v.present? } %>
            <div class="active-filters">
              <span>Active filters:</span>
              <% if params[:customer].present? %>
                <span class="filter-tag">Customer: <%= params[:customer] %></span>
              <% end %>
              <% if params[:status].present? %>
                <span class="filter-tag">Status: <%= params[:status].humanize %></span>
              <% end %>
              <% if params[:month].present? %>
                <span class="filter-tag">Month: <%= Date::MONTHNAMES[params[:month].to_i] %></span>
              <% end %>
              <% if params[:year].present? %>
                <span class="filter-tag">Year: <%= params[:year] %></span>
              <% end %>
              <%= link_to sales_invoices_path, class: "btn btn-sm btn-outline-secondary" do %>
                <i class="fas fa-times"></i> Clear All
              <% end %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>

    <!-- Invoices List -->
    <div class="content-section">
      <div class="content-header">
        <h5><i class="fas fa-list me-2"></i>Invoices (<%= @sales_invoices.count %>)</h5>
        <div class="view-controls">
          <div class="btn-group" role="group">
            <button class="btn btn-sm btn-outline-secondary active" id="tableView">
              <i class="fas fa-table"></i>
            </button>
            <button class="btn btn-sm btn-outline-secondary" id="cardView">
              <i class="fas fa-th"></i>
            </button>
          </div>
        </div>
      </div>

      <% if @sales_invoices.any? %>
        <!-- Table View -->
        <div id="tableViewContent" class="table-section">
          <div class="table-responsive">
            <table class="table invoice-table">
              <thead>
                <tr>
                  <th>Invoice #</th>
                  <th>Customer</th>
                  <th>Date</th>
                  <th>Due Date</th>
                  <th>Amount</th>
                  <th>Paid</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <% @sales_invoices.each do |invoice| %>
                  <tr>
                    <td>
                      <div class="invoice-number">
                        <%= link_to invoice.invoice_number, sales_invoice_path(invoice) %>
                      </div>
                    </td>
                    <td>
                      <div class="customer-info">
                        <div class="customer-name"><%= invoice.customer_name %></div>
                        <% if invoice.customer_phone.present? %>
                          <div class="customer-phone"><%= invoice.customer_phone %></div>
                        <% end %>
                      </div>
                    </td>
                    <td><%= invoice.invoice_date.strftime('%d %b %Y') %></td>
                    <td>
                      <div class="due-date <%= invoice.due_date < Date.current && invoice.status != 'paid' ? 'overdue' : '' %>">
                        <%= invoice.due_date.strftime('%d %b %Y') %>
                        <% if invoice.due_date < Date.current && invoice.status != 'paid' %>
                          <small class="overdue-text">
                            <%= (Date.current - invoice.due_date).to_i %> days overdue
                          </small>
                        <% end %>
                      </div>
                    </td>
                    <td class="amount">₹<%= number_with_delimiter(invoice.total_amount || 0, precision: 0) %></td>
                    <td class="amount paid">₹<%= number_with_delimiter(invoice.paid_amount || 0, precision: 0) %></td>
                    <td>
                      <% case invoice.status %>
                      <% when 'paid' %>
                        <span class="badge badge-success">Paid</span>
                      <% when 'pending' %>
                        <span class="badge badge-warning">Unpaid</span>
                      <% when 'partially_paid' %>
                        <span class="badge badge-info">Partial</span>
                      <% when 'overdue' %>
                        <span class="badge badge-danger">Overdue</span>
                      <% else %>
                        <span class="badge badge-secondary"><%= invoice.status.humanize %></span>
                      <% end %>
                    </td>
                    <td>
                      <div class="action-buttons">
                        <%= link_to sales_invoice_path(invoice), 
                            class: "btn btn-sm btn-outline-primary", 
                            title: "View" do %>
                          <i class="fas fa-eye"></i>
                        <% end %>
                        
                        <%= link_to download_pdf_sales_invoice_path(invoice), 
                            class: 'btn btn-sm btn-outline-info', 
                            target: '_blank',
                            title: "PDF" do %>
                          <i class="fas fa-file-pdf"></i>
                        <% end %>
                        
                        <%= button_to sales_invoice_path(invoice),
                            method: :delete,
                            form: { 
                              "data-turbo-confirm": "Are you sure?", 
                              class: "d-inline" 
                            },
                            class: "btn btn-sm btn-outline-danger",
                            title: "Delete" do %>
                          <i class="fas fa-trash"></i>
                        <% end %>
                      </div>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Card View -->
        <div id="cardViewContent" class="d-none card-section">
          <div class="row g-4">
            <% @sales_invoices.each do |invoice| %>
              <div class="col-lg-4 col-md-6">
                <div class="invoice-card">
                  <div class="card-header">
                    <div class="invoice-number">
                      <%= link_to invoice.invoice_number, sales_invoice_path(invoice) %>
                    </div>
                    <div class="invoice-status">
                      <% case invoice.status %>
                      <% when 'paid' %>
                        <span class="badge badge-success">Paid</span>
                      <% when 'pending' %>
                        <span class="badge badge-warning">Unpaid</span>
                      <% when 'partially_paid' %>
                        <span class="badge badge-info">Partial</span>
                      <% when 'overdue' %>
                        <span class="badge badge-danger">Overdue</span>
                      <% else %>
                        <span class="badge badge-secondary"><%= invoice.status.humanize %></span>
                      <% end %>
                    </div>
                  </div>
                  
                  <div class="card-body">
                    <div class="customer-name"><%= invoice.customer_name %></div>
                    <% if invoice.customer_phone.present? %>
                      <div class="customer-phone"><%= invoice.customer_phone %></div>
                    <% end %>
                    
                    <div class="invoice-details">
                      <div class="detail-row">
                        <span>Date:</span>
                        <span><%= invoice.invoice_date.strftime('%d %b %Y') %></span>
                      </div>
                      <div class="detail-row">
                        <span>Due Date:</span>
                        <span class="<%= invoice.due_date < Date.current && invoice.status != 'paid' ? 'text-danger' : '' %>">
                          <%= invoice.due_date.strftime('%d %b %Y') %>
                        </span>
                      </div>
                      <div class="detail-row">
                        <span>Amount:</span>
                        <span class="amount">₹<%= number_with_delimiter(invoice.total_amount || 0, precision: 0) %></span>
                      </div>
                      <div class="detail-row">
                        <span>Paid:</span>
                        <span class="amount paid">₹<%= number_with_delimiter(invoice.paid_amount || 0, precision: 0) %></span>
                      </div>
                    </div>
                  </div>
                  
                  <div class="card-footer">
                    <%= link_to sales_invoice_path(invoice), class: "btn btn-sm btn-outline-primary" do %>
                      <i class="fas fa-eye"></i> View
                    <% end %>
                    <%= link_to download_pdf_sales_invoice_path(invoice), 
                        class: 'btn btn-sm btn-outline-info', 
                        target: '_blank' do %>
                      <i class="fas fa-file-pdf"></i> PDF
                    <% end %>
                    <%= button_to sales_invoice_path(invoice),
                        method: :delete,
                        form: { 
                          "data-turbo-confirm": "Are you sure?", 
                          class: "d-inline" 
                        },
                        class: "btn btn-sm btn-outline-danger" do %>
                      <i class="fas fa-trash"></i> Delete
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% else %>
        <div class="empty-state">
          <div class="empty-icon">
            <i class="fas fa-file-invoice-dollar"></i>
          </div>
          <h4>No Sales Invoices Found</h4>
          <% if params.to_unsafe_h.any? { |k, v| k.in?(['customer', 'status', 'month', 'year', 'amount_min']) && v.present? } %>
            <p>No invoices match your current filters.</p>
            <%= link_to sales_invoices_path, class: "btn btn-outline-primary" do %>
              <i class="fas fa-times"></i> Clear Filters
            <% end %>
          <% else %>
            <p>Start by creating your first sales invoice.</p>
            <%= link_to new_sales_invoice_path, class: 'btn btn-primary' do %>
              <i class="fas fa-plus"></i> Create Sales Invoice
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<style>
/* Clean Sales Invoices Styles */
.page-wrapper {
  background: #f8fafc;
  min-height: 100vh;
}

/* Page Header */
.page-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 2rem 0;
  margin-bottom: 2rem;
}

.header-content {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.header-icon {
  width: 60px;
  height: 60px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
}

.header-text h1 {
  margin: 0;
  font-size: 2rem;
  font-weight: 700;
}

.header-text p {
  margin: 0;
  opacity: 0.9;
  font-size: 1.1rem;
}

.btn-create {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  background: rgba(255, 255, 255, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  border-radius: 8px;
  text-decoration: none;
  transition: all 0.3s ease;
}

.btn-create:hover {
  background: rgba(255, 255, 255, 0.25);
  color: white;
  transform: translateY(-1px);
}

/* Stats Section */
.stats-section {
  margin-bottom: 2rem;
}

.stat-card {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  display: flex;
  align-items: center;
  gap: 1rem;
  border-left: 4px solid;
  transition: all 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.stat-card-blue {
  border-left-color: #3b82f6;
}

.stat-card-green {
  border-left-color: #10b981;
}

.stat-card-orange {
  border-left-color: #f59e0b;
}

.stat-card-red {
  border-left-color: #ef4444;
}

.stat-icon {
  width: 50px;
  height: 50px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.25rem;
  color: white;
}

.stat-card-blue .stat-icon {
  background: #3b82f6;
}

.stat-card-green .stat-icon {
  background: #10b981;
}

.stat-card-orange .stat-icon {
  background: #f59e0b;
}

.stat-card-red .stat-icon {
  background: #ef4444;
}

.stat-content h3 {
  margin: 0;
  font-size: 1.5rem;
  font-weight: 700;
  color: #1f2937;
}

.stat-content p {
  margin: 0;
  color: #6b7280;
  font-size: 0.875rem;
}

/* Filters Section */
.filters-section {
  margin-bottom: 2rem;
}

.filters-card {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.filters-form .form-control,
.filters-form .form-select {
  border-radius: 8px;
  border: 1px solid #d1d5db;
  padding: 0.5rem 0.75rem;
}

.filters-form .form-control:focus,
.filters-form .form-select:focus {
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.active-filters {
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid #e5e7eb;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.filter-tag {
  background: #e5e7ff;
  color: #4f46e5;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.75rem;
}

/* Content Section */
.content-section {
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  overflow: hidden;
}

.content-header {
  padding: 1.5rem;
  border-bottom: 1px solid #e5e7eb;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #f8fafc;
}

.content-header h5 {
  margin: 0;
  color: #1f2937;
  font-weight: 600;
}

.view-controls .btn {
  border-radius: 6px;
  padding: 0.5rem 0.75rem;
}

.view-controls .btn.active {
  background: #3b82f6;
  border-color: #3b82f6;
  color: white;
}

/* Table Section */
.table-section {
  padding: 0;
}

.invoice-table {
  margin: 0;
}

.invoice-table th {
  background: #f8fafc;
  border-bottom: 2px solid #e5e7eb;
  font-weight: 600;
  color: #374151;
  padding: 1rem;
  font-size: 0.875rem;
}

.invoice-table td {
  padding: 1rem;
  border-bottom: 1px solid #f3f4f6;
  vertical-align: middle;
}

.invoice-table tbody tr:hover {
  background: #f8fafc;
}

.invoice-number a {
  color: #3b82f6;
  text-decoration: none;
  font-weight: 600;
}

.invoice-number a:hover {
  text-decoration: underline;
}

.customer-info .customer-name {
  font-weight: 600;
  color: #1f2937;
}

.customer-info .customer-phone {
  font-size: 0.875rem;
  color: #6b7280;
}

.due-date.overdue {
  color: #ef4444;
  font-weight: 600;
}

.overdue-text {
  display: block;
  font-size: 0.75rem;
  color: #ef4444;
}

.amount {
  font-weight: 600;
  color: #059669;
}

.amount.paid {
  color: #0891b2;
}

.badge {
  padding: 0.375rem 0.75rem;
  border-radius: 6px;
  font-size: 0.75rem;
  font-weight: 500;
  text-transform: uppercase;
}

.badge-success {
  background: #d1fae5;
  color: #065f46;
}

.badge-warning {
  background: #fef3c7;
  color: #92400e;
}

.badge-info {
  background: #dbeafe;
  color: #1e40af;
}

.badge-danger {
  background: #fee2e2;
  color: #991b1b;
}

.badge-secondary {
  background: #f3f4f6;
  color: #374151;
}

.action-buttons {
  display: flex;
  gap: 0.25rem;
}

.action-buttons .btn {
  border-radius: 6px;
}

/* Card Section */
.card-section {
  padding: 1.5rem;
}

.invoice-card {
  background: white;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  transition: all 0.3s ease;
}

.invoice-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.invoice-card .card-header {
  padding: 1rem;
  border-bottom: 1px solid #e5e7eb;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #f8fafc;
}

.invoice-card .card-body {
  padding: 1rem;
}

.invoice-card .customer-name {
  font-weight: 600;
  color: #1f2937;
  margin-bottom: 0.25rem;
}

.invoice-card .customer-phone {
  font-size: 0.875rem;
  color: #6b7280;
  margin-bottom: 1rem;
}

.invoice-details {
  margin-bottom: 1rem;
}

.detail-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.5rem;
  font-size: 0.875rem;
}

.detail-row span:first-child {
  color: #6b7280;
}

.detail-row span:last-child {
  font-weight: 500;
  color: #1f2937;
}

.invoice-card .card-footer {
  padding: 1rem;
  border-top: 1px solid #e5e7eb;
  display: flex;
  gap: 0.5rem;
  background: #f8fafc;
}

.invoice-card .card-footer .btn {
  flex: 1;
  border-radius: 6px;
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 3rem 1.5rem;
  color: #6b7280;
}

.empty-icon {
  font-size: 4rem;
  color: #d1d5db;
  margin-bottom: 1rem;
}

.empty-state h4 {
  color: #374151;
  margin-bottom: 0.5rem;
}

.empty-state p {
  margin-bottom: 1.5rem;
}

/* Responsive */
@media (max-width: 768px) {
  .header-content {
    flex-direction: column;
    text-align: center;
    gap: 0.5rem;
  }
  
  .header-text h1 {
    font-size: 1.5rem;
  }
  
  .content-header {
    flex-direction: column;
    gap: 1rem;
    text-align: center;
  }
  
  .action-buttons {
    flex-direction: column;
  }
  
  .invoice-card .card-footer {
    flex-direction: column;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const tableView = document.getElementById('tableView');
  const cardView = document.getElementById('cardView');
  const tableContent = document.getElementById('tableViewContent');
  const cardContent = document.getElementById('cardViewContent');
  
  if (tableView && cardView) {
    tableView.addEventListener('click', function() {
      tableView.classList.add('active');
      cardView.classList.remove('active');
      tableContent.classList.remove('d-none');
      cardContent.classList.add('d-none');
    });
    
    cardView.addEventListener('click', function() {
      cardView.classList.add('active');
      tableView.classList.remove('active');
      cardContent.classList.remove('d-none');
      tableContent.classList.add('d-none');
    });
  }
});
</script>